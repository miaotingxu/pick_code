# 应用签名配置操作指南

> **包名**: `com.mtx.take.code`  
> **密码**: `miao1234`  
> **创建时间**: 2025-10-24

---

## 🎯 推荐方案：使用 DevEco Studio 自动签名（最简单）⭐

### 步骤 1: 打开签名配置

1. 在 DevEco Studio 中打开项目
2. 点击菜单栏 **File** → **Project Structure**
3. 或按快捷键 **Ctrl + Alt + Shift + S**

---

### 步骤 2: 配置自动签名

1. 在左侧选择 **Project** → **Signing Configs**

2. 勾选 ✅ **Automatically generate signature**

3. 选择 **Support HarmonyOS**

4. 点击 **Apply** → **OK**

**完成！** DevEco Studio 会自动：
- ✅ 生成调试签名文件
- ✅ 配置签名信息
- ✅ 保存到安全位置
- ✅ 每次构建时自动签名

---

## 🔧 方案二：手动生成签名文件

如果需要手动配置签名，按以下步骤操作：

### 步骤 1: 生成密钥对 (.p12 文件)

**在 DevEco Studio 中生成（推荐）：**

1. 点击菜单 **Build** → **Generate Key and CSR**

2. 填写以下信息：
   ```
   Key Alias:     pickcode_key
   Password:      miao1234
   Confirm:       miao1234
   Validity:      25 (年)
   ```

3. 填写证书信息：
   ```
   Organization:         MTX
   Organization Unit:    Development
   City/Locality:        Beijing
   State/Province:       Beijing
   Country Code:         CN
   ```

4. 选择保存位置：
   ```
   F:\HarmonyOS\PickCode\signature\pickcode.p12
   ```

5. 点击 **OK** 生成

---

### 步骤 2: 申请调试证书

**对于开发测试：**

1. **File** → **Project Structure** → **Signing Configs**

2. **勾选 Support HarmonyOS**

3. **配置签名信息**：
   ```
   Store File:      signature/pickcode.p12
   Store Password:  miao1234
   Key Alias:       pickcode_key
   Key Password:    miao1234
   ```

4. 点击 **Apply** → **OK**

**DevEco Studio 会自动生成调试证书（.cer）和配置文件（.p7b）**

---

### 步骤 3: 修改 build-profile.json5

如果需要手动配置，编辑项目根目录的 `build-profile.json5`：

```json5
{
  "app": {
    "signingConfigs": [
      {
        "name": "default",
        "type": "HarmonyOS",
        "material": {
          "storeFile": "signature/pickcode.p12",
          "storePassword": "miao1234",
          "keyAlias": "pickcode_key",
          "keyPassword": "miao1234",
          "signAlg": "SHA256withRSA",
          "certpath": "signature/pickcode.cer",
          "profile": "signature/pickcode.p7b"
        }
      }
    ],
    "products": [
      {
        "name": "default",
        "signingConfig": "default",
        "targetSdkVersion": "6.0.0(20)",
        "compatibleSdkVersion": "6.0.0(20)",
        "runtimeOS": "HarmonyOS"
      }
    ]
  }
}
```

---

## 🛠️ 方案三：使用命令行生成签名文件

如果你想用命令行生成，需要先找到 keytool：

### 查找 keytool

```powershell
# 方法 1: 查找 Java keytool
where.exe keytool

# 方法 2: 查找 HarmonyOS SDK 中的 keytool
Get-ChildItem "$env:LOCALAPPDATA\Huawei\Sdk" -Recurse -Filter "keytool*"
```

### 生成密钥库

找到 keytool 后，执行：

```powershell
keytool -genkeypair `
  -keystore signature\pickcode.p12 `
  -storetype PKCS12 `
  -keyalg RSA `
  -keysize 2048 `
  -validity 9125 `
  -alias pickcode_key `
  -storepass miao1234 `
  -keypass miao1234 `
  -dname "CN=MTX PickCode,OU=Development,O=MTX,L=Beijing,ST=Beijing,C=CN"
```

### 验证生成的密钥

```powershell
keytool -list -v `
  -keystore signature\pickcode.p12 `
  -storepass miao1234
```

---

## 📋 签名配置参数说明

| 参数 | 值 | 说明 |
|------|-----|------|
| **Store File** | `signature/pickcode.p12` | 密钥库文件路径 |
| **Store Password** | `miao1234` | 密钥库密码 |
| **Key Alias** | `pickcode_key` | 密钥别名 |
| **Key Password** | `miao1234` | 密钥密码 |
| **Sign Algorithm** | `SHA256withRSA` | 签名算法 |
| **Validity** | `25 years` | 有效期 |
| **Organization** | `MTX` | 组织名称 |

---

## 🔍 验证签名配置

### 检查签名文件

```powershell
# 查看 signature 目录
Get-ChildItem signature\

# 应该看到：
# pickcode.p12 (必须)
# pickcode.cer (自动生成)
# pickcode.p7b (自动生成)
```

### 构建并测试

```
1. Build → Clean Project
2. Build → Rebuild Project
3. Run → Run 'entry' (Shift + F10)
```

如果构建成功并能安装到设备，说明签名配置正确！

---

## ⚠️ 重要提示

### 1. 签名文件安全

**已在 .gitignore 中排除签名文件：**

```gitignore
# Signing files (IMPORTANT: Keep these private!)
signature/*.p12
signature/*.cer
signature/*.p7b
signature/*.jks
*.keystore
*.p12
*.csr
material/
```

**请勿将以下文件提交到 Git：**
- ❌ `pickcode.p12` (私钥)
- ❌ 任何包含密码的配置文件

---

### 2. 密码管理

**当前密码**: `miao1234`

**建议**：
- ✅ 不要在代码中硬编码密码
- ✅ 使用环境变量或配置文件
- ✅ 发布版本使用不同的密码

---

### 3. 签名类型

| 类型 | 用途 | 生成方式 |
|------|------|----------|
| **调试签名** | 开发测试 | DevEco Studio 自动生成 |
| **发布签名** | 正式发布 | 手动申请 + 配置 |

**对于当前开发阶段**：使用调试签名即可

---

## 🚀 快速配置流程

### 最简单的配置（推荐）

```
1. 打开 DevEco Studio
   ↓
2. File → Project Structure
   ↓
3. Signing Configs → ✅ Automatically generate signature
   ↓
4. Apply → OK
   ↓
5. Build → Rebuild Project
   ↓
6. ✅ 完成！
```

**用时**：不到 1 分钟

---

## 🎯 签名配置后的操作

### 1. 重新构建

```
Build → Clean Project
Build → Rebuild Project
```

### 2. 安装到设备

```
Run → Run 'entry' (Shift + F10)
```

### 3. 验证签名

```powershell
# 查看 HAP 包信息
hdc shell bm dump -n com.mtx.take.code
```

---

## 📝 故障排查

### 问题 1: "签名失败"

**可能原因**：
- 密码错误
- 签名文件路径不对
- 证书过期

**解决方案**：
1. 检查密码是否正确：`miao1234`
2. 检查 `signature/pickcode.p12` 是否存在
3. 重新生成签名文件

---

### 问题 2: "找不到签名配置"

**解决方案**：

1. 检查 `build-profile.json5` 中的 `signingConfigs`
2. 确保 `products` 中配置了 `signingConfig: "default"`
3. 重新同步项目

---

### 问题 3: 自动签名不生效

**解决方案**：

```
1. File → Invalidate Caches / Restart
2. File → Project Structure → Signing Configs
3. 重新勾选 "Automatically generate signature"
4. Apply → OK
5. Build → Rebuild Project
```

---

## ✅ 配置完成检查清单

- [ ] 已在 DevEco Studio 中打开项目
- [ ] 已配置自动签名或手动签名
- [ ] 签名文件已生成（如果手动配置）
- [ ] build-profile.json5 已配置（如果手动配置）
- [ ] 已重新构建项目
- [ ] 应用能成功安装到设备
- [ ] 应用能正常运行
- [ ] 签名文件已添加到 .gitignore

---

## 📞 相关文档

- 📄 `docs/签名配置指南.md` - 更详细的签名说明
- 📄 `启动错误修复指南.md` - 安装问题排查
- 📄 `打包安装说明.md` - 完整的打包流程
- 📄 [HarmonyOS 官方文档](https://developer.harmonyos.com/)

---

## 🎉 推荐操作

**最快速的配置方式**：

1. 打开 DevEco Studio
2. File → Project Structure → Signing Configs
3. ✅ Automatically generate signature
4. Apply → OK
5. Shift + F10 运行

**完成！** DevEco Studio 会自动处理所有签名相关的事情。

---

**当前密码**: `miao1234`  
**包名**: `com.mtx.take.code`  
**推荐方式**: 自动签名 ⭐

---

**文档版本**: v1.0  
**创建时间**: 2025-10-24  
**状态**: ✅ 可用


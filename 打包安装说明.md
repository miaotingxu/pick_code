# 快递取件码管理 APP - 打包安装说明

> **生成时间**: 2025-10-24  
> **版本**: v1.0.0  
> **平台**: HarmonyOS

---

## 📦 已生成的安装包

✅ **当前项目根目录下已有安装包：`PickCode-unsigned.hap`**

- **文件名**: `PickCode-unsigned.hap`
- **类型**: 未签名版本（开发测试用）
- **大小**: 约 2-5 MB
- **用途**: 开发调试、内部测试

---

## 🚀 安装方式

### 方式一：通过 DevEco Studio 安装（推荐）

#### 步骤：
1. 打开 **DevEco Studio**
2. 连接 HarmonyOS 设备或启动模拟器
3. 点击顶部菜单 `Run` → `Run 'entry'` 或按 `Shift + F10`
4. 等待自动编译、签名、安装

**优点**：
- ✅ 自动处理签名
- ✅ 自动安装到设备
- ✅ 可以直接调试

---

### 方式二：通过 HDC 命令行安装

#### 前提条件：
1. HarmonyOS 设备已开启**开发者模式**
2. 电脑已安装 **HarmonyOS SDK**
3. 设备通过 USB 连接到电脑

#### 步骤：

**1. 检查设备连接**
```powershell
# 查看已连接的设备
hdc list targets

# 如果显示设备序列号，说明连接成功
```

**2. 安装 HAP 包**
```powershell
# 在项目根目录执行
hdc install PickCode-unsigned.hap

# 或者使用绝对路径
hdc install F:\HarmonyOS\PickCode\PickCode-unsigned.hap
```

**3. 查看安装结果**
```powershell
# 安装成功会显示：
# install bundle successfully.

# 如果失败，查看错误信息
```

**4. 启动应用**
```powershell
# 手动在设备上点击应用图标启动
# 或者通过命令启动（可选）
hdc shell aa start -a EntryAbility -b com.pickcode
```

---

### 方式三：通过文件管理器安装（仅限已签名的 HAP）

1. 将 `PickCode-unsigned.hap` 文件传输到 HarmonyOS 设备
2. 在设备上使用**文件管理器**找到该文件
3. 点击文件，按提示安装

**⚠️ 注意**：未签名的 HAP 可能无法通过此方式安装，建议使用方式一或方式二。

---

## 🔐 签名配置（发布用）

### 为什么需要签名？

- **开发测试**：DevEco Studio 会自动生成调试签名
- **正式发布**：需要在华为开发者平台申请正式签名

### 快速签名方式（推荐）

#### 使用 DevEco Studio 自动签名

1. 打开 DevEco Studio
2. 点击菜单 `File` → `Project Structure`
3. 选择 `Signing Configs`
4. 勾选 ✅ `Automatically generate signature`
5. 选择 `Support HarmonyOS`
6. 点击 `Apply` 和 `OK`

✅ **完成！DevEco Studio 会自动生成调试签名并保存。**

---

### 手动签名方式（高级）

详细步骤请参考：`docs/签名配置指南.md`

#### 简要流程：

1. **生成密钥对** (`.p12` 文件)
2. **申请证书** (`.cer` 文件) - 从华为开发者平台
3. **申请 Profile** (`.p7b` 文件) - 从华为开发者平台
4. **配置到项目** - 修改 `build-profile.json5`
5. **重新打包** - 生成已签名的 HAP

---

## 🔨 重新打包（从源码构建）

### 方式一：通过 DevEco Studio（推荐）

#### 调试版本（Debug）
```
1. 打开项目
2. 点击 Build → Build Hap(s)/App(s) → Build Hap(s)
3. 等待编译完成
4. 输出位置：entry/build/default/outputs/default/entry-default-unsigned.hap
```

#### 发布版本（Release）
```
1. 确保已配置签名（见上方签名配置）
2. 点击 Build → Generate Hap(s)/App(s) → Generate Signed Hap(s)
3. 选择签名配置
4. 点击 OK 开始打包
5. 输出位置：entry/build/default/outputs/default/entry-default-signed.hap
```

---

### 方式二：通过命令行

#### 前提条件：
- 已安装 Node.js
- 已配置 HarmonyOS SDK 环境变量

#### 步骤：

**1. 安装依赖**
```powershell
# 使用 ohpm 安装（如果配置了环境变量）
ohpm install

# 或者使用项目内的 hvigor
node --version  # 确保 Node.js 已安装
```

**2. 执行构建**
```powershell
# Debug 版本
hvigorw assembleHap --mode module -p module=entry -p product=default

# Release 版本（需要先配置签名）
hvigorw assembleHap --mode module -p module=entry -p product=default --release
```

**3. 查看输出**
```powershell
# 打包后的文件位置：
entry/build/default/outputs/default/entry-default-unsigned.hap
```

---

## 📱 设备开发者模式开启

### HarmonyOS 手机：

1. 打开 `设置`
2. 进入 `关于手机`
3. 连续点击 `版本号` 7次
4. 输入锁屏密码
5. 返回 `设置` → `系统和更新` → `开发人员选项`
6. 开启 `USB 调试`
7. 开启 `允许ADB调试`（如果有）

### HarmonyOS 平板同理

---

## 🛠️ 常见问题排查

### Q1: `hdc: command not found` 或 `hdc 不是内部或外部命令`

**解决方案：**

1. 确认已安装 HarmonyOS SDK
2. 配置环境变量：
   ```powershell
   # SDK 工具路径（示例）
   C:\Users\YourName\Huawei\Sdk\openharmony\[版本号]\toolchains
   ```
3. 重启终端或电脑

---

### Q2: `install bundle failed`

**可能原因：**
- ❌ 设备未开启开发者模式
- ❌ 签名不匹配
- ❌ 应用已安装旧版本（签名不同）

**解决方案：**
```powershell
# 1. 卸载旧版本
hdc uninstall com.pickcode

# 2. 重新安装
hdc install PickCode-unsigned.hap
```

---

### Q3: DevEco Studio 编译失败

**检查项：**
- ✅ SDK 是否完整下载
- ✅ Node.js 是否已安装
- ✅ 项目依赖是否已安装（oh_modules/）
- ✅ 签名配置是否正确

**解决方案：**
```
1. File → Invalidate Caches / Restart
2. 删除 oh_modules 和 build 目录
3. 重新打开项目
4. Build → Clean Project
5. Build → Rebuild Project
```

---

### Q4: 未签名的 HAP 能否安装？

**能，但有限制：**

✅ **可以安装的情况：**
- 设备开启了开发者模式
- 通过 hdc 命令行安装
- 设备允许调试

❌ **不能安装的情况：**
- 未开启开发者模式
- 通过文件管理器直接点击
- 设备未连接可信电脑

---

## 📋 安装验证

### 安装成功后检查：

**1. 查看已安装应用**
```powershell
hdc shell bm dump -a
# 查找 com.pickcode
```

**2. 启动应用**
```powershell
hdc shell aa start -a EntryAbility -b com.pickcode
```

**3. 查看应用日志**
```powershell
hdc hilog | findstr PickCode
```

---

## 🎯 完整流程总结

### 开发测试流程（推荐）

```
1. 打开 DevEco Studio
   ↓
2. 连接设备/启动模拟器
   ↓
3. 点击 Run 按钮（Shift + F10）
   ↓
4. 自动编译 → 自动签名 → 自动安装 → 自动启动
   ↓
5. ✅ 完成！
```

**用时**：约 30 秒 - 2 分钟

---

### 命令行安装流程

```
1. 确保设备连接：hdc list targets
   ↓
2. 安装 HAP：hdc install PickCode-unsigned.hap
   ↓
3. 启动应用：在设备上手动点击
   ↓
4. ✅ 完成！
```

**用时**：约 10-30 秒

---

### 正式发布流程

```
1. 注册华为开发者账号
   ↓
2. 在 AppGallery Connect 创建应用
   ↓
3. 申请发布证书和 Profile
   ↓
4. 配置签名到项目
   ↓
5. 打包发布版本（Build → Generate Signed Hap）
   ↓
6. 上传到华为应用市场审核
   ↓
7. ✅ 审核通过后上架！
```

**用时**：首次约 1-3 天（审核时间）

---

## 📞 技术支持

### 相关文档：
- 📄 `docs/签名配置指南.md` - 详细签名配置步骤
- 📄 `README.md` - 项目功能说明
- 📄 `QUICKSTART.md` - 快速开始指南

### 官方文档：
- [HarmonyOS 应用开发](https://developer.harmonyos.com/cn/develop/)
- [DevEco Studio 使用指南](https://developer.harmonyos.com/cn/develop/deveco-studio)
- [HDC 工具使用](https://gitee.com/openharmony/docs/blob/master/zh-cn/device-dev/subsystems/subsys-toolchain-hdc-guide.md)

---

**当前安装包位置**: `F:\HarmonyOS\PickCode\PickCode-unsigned.hap`

**推荐安装方式**: 使用 DevEco Studio 直接运行（最简单！）

---

**文档版本**: v1.0  
**最后更新**: 2025-10-24  
**状态**: ✅ 可用


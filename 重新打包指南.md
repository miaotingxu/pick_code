# 快递取件码管理 APP - 重新打包指南

> **更新时间**: 2025-10-24  
> **原因**: 更换应用图标为 big_logo  
> **状态**: 需要重新构建

---

## ⚠️ 重要提示

由于我们刚刚更换了应用图标（从 `layered_image` 改为 `big_logo`），需要重新打包生成新的安装包，以确保新图标生效。

---

## 🚀 使用 DevEco Studio 打包（推荐）

### 方式一：快速构建（Debug版本）

#### 步骤：

1. **打开 DevEco Studio**
   - 确保项目已经打开

2. **清理旧构建**
   ```
   菜单栏 → Build → Clean Project
   ```
   等待清理完成（约5-10秒）

3. **重新构建项目**
   ```
   菜单栏 → Build → Rebuild Project
   ```
   等待编译完成（首次约1-3分钟）

4. **生成 HAP 包**
   ```
   菜单栏 → Build → Build Hap(s)/App(s) → Build Hap(s)
   ```
   或者直接按快捷键：`Ctrl + F9`

5. **查看输出文件**
   ```
   输出位置：entry/build/default/outputs/default/entry-default-unsigned.hap
   ```

6. **复制到项目根目录**（可选）
   ```powershell
   Copy-Item "entry\build\default\outputs\default\entry-default-unsigned.hap" -Destination "PickCode-unsigned.hap"
   ```

---

### 方式二：直接运行（最快）

如果只是想测试新图标，最简单的方式：

1. **连接设备或启动模拟器**

2. **点击运行按钮**
   ```
   工具栏 → Run 按钮（绿色三角形）
   或按快捷键：Shift + F10
   ```

3. **等待自动安装**
   - DevEco Studio 会自动编译
   - 自动签名
   - 自动安装到设备
   - 自动启动应用

4. **查看新图标**
   - 在设备桌面查看应用图标
   - 应该显示为 `big_logo`

---

## 📦 使用命令行打包（高级）

### 前提条件

需要先配置 HarmonyOS 命令行工具：

```powershell
# 1. 确保 Node.js 已安装
node --version

# 2. 全局安装 ohpm（如果未安装）
npm install -g @ohos/ohpm

# 3. 安装项目依赖
ohpm install
```

### 构建命令

```powershell
# 方式 1: 使用 hvigor（如果项目配置了）
npx hvigor assembleHap --mode module -p module=entry -p product=default

# 方式 2: 使用 DevEco Studio CLI（需要配置环境变量）
deveco build --project . --module entry
```

### 输出位置

```
entry/build/default/outputs/default/entry-default-unsigned.hap
```

---

## 🔍 验证新图标

### 1. 检查 HAP 包内容

```powershell
# 查看 HAP 包大小和时间戳
Get-Item entry\build\default\outputs\default\entry-default-unsigned.hap | Format-List

# 解压查看资源（可选）
Expand-Archive -Path "entry\build\default\outputs\default\entry-default-unsigned.hap" -DestinationPath "temp_hap" -Force

# 检查是否包含 big_logo.png
Get-ChildItem temp_hap -Recurse -Filter "big_logo.png"

# 清理临时文件
Remove-Item temp_hap -Recurse -Force
```

---

### 2. 安装到设备测试

```powershell
# 1. 检查设备连接
hdc list targets

# 2. 卸载旧版本
hdc uninstall com.example.first

# 3. 安装新版本
hdc install entry\build\default\outputs\default\entry-default-unsigned.hap

# 4. 启动应用
hdc shell aa start -a EntryAbility -b com.example.first
```

---

### 3. 图标验证点

新安装后检查以下位置的图标：

- ✅ **桌面图标** - 主屏幕的应用图标
- ✅ **应用抽屉** - 所有应用列表
- ✅ **启动画面** - 应用启动时的 Splash Screen
- ✅ **设置页面** - 设置 → 应用管理
- ✅ **任务管理器** - 最近任务列表

**预期效果**：所有位置都应显示 `big_logo` 图标

---

## 📝 PowerShell 一键打包脚本

创建一个 PowerShell 脚本快速打包：

### rebuild.ps1

```powershell
# rebuild.ps1 - 快速重新打包脚本

Write-Host "=====================================" -ForegroundColor Cyan
Write-Host "  快递取件码管理 - 重新打包工具" -ForegroundColor Cyan
Write-Host "=====================================" -ForegroundColor Cyan
Write-Host ""

# 1. 清理旧构建
Write-Host "[1/5] 清理旧构建..." -ForegroundColor Yellow
Remove-Item "entry\build" -Recurse -Force -ErrorAction SilentlyContinue
Remove-Item "PickCode-unsigned.hap" -ErrorAction SilentlyContinue
Write-Host "✓ 清理完成" -ForegroundColor Green
Write-Host ""

# 2. 检查 Node.js
Write-Host "[2/5] 检查环境..." -ForegroundColor Yellow
$nodeVersion = node --version 2>&1
if ($LASTEXITCODE -eq 0) {
    Write-Host "✓ Node.js: $nodeVersion" -ForegroundColor Green
} else {
    Write-Host "✗ Node.js 未安装" -ForegroundColor Red
    exit 1
}
Write-Host ""

# 3. 安装依赖（如果需要）
Write-Host "[3/5] 检查依赖..." -ForegroundColor Yellow
if (-not (Test-Path "oh_modules")) {
    Write-Host "安装依赖中..." -ForegroundColor Yellow
    ohpm install
    if ($LASTEXITCODE -ne 0) {
        Write-Host "✗ 依赖安装失败" -ForegroundColor Red
        Write-Host "  请手动在 DevEco Studio 中构建" -ForegroundColor Yellow
        exit 1
    }
}
Write-Host "✓ 依赖检查完成" -ForegroundColor Green
Write-Host ""

# 4. 构建项目
Write-Host "[4/5] 构建项目（这可能需要1-3分钟）..." -ForegroundColor Yellow
Write-Host "  如果此步骤失败，请使用 DevEco Studio 构建" -ForegroundColor Gray
Write-Host ""

# 尝试使用 hvigor 构建
npx hvigor assembleHap --mode module -p module=entry -p product=default 2>&1 | Out-Null

if ($LASTEXITCODE -eq 0 -and (Test-Path "entry\build\default\outputs\default\entry-default-unsigned.hap")) {
    Write-Host "✓ 构建成功" -ForegroundColor Green
    
    # 5. 复制到根目录
    Write-Host ""
    Write-Host "[5/5] 复制安装包..." -ForegroundColor Yellow
    Copy-Item "entry\build\default\outputs\default\entry-default-unsigned.hap" -Destination "PickCode-unsigned.hap"
    
    $fileInfo = Get-Item "PickCode-unsigned.hap"
    $sizeKB = [math]::Round($fileInfo.Length / 1KB, 2)
    
    Write-Host "✓ 打包完成！" -ForegroundColor Green
    Write-Host ""
    Write-Host "=====================================" -ForegroundColor Cyan
    Write-Host "📦 安装包信息" -ForegroundColor Cyan
    Write-Host "=====================================" -ForegroundColor Cyan
    Write-Host "文件名: PickCode-unsigned.hap"
    Write-Host "大小: $sizeKB KB"
    Write-Host "位置: $($fileInfo.FullName)"
    Write-Host "时间: $($fileInfo.LastWriteTime)"
    Write-Host ""
    Write-Host "使用以下命令安装：" -ForegroundColor Yellow
    Write-Host "  hdc install PickCode-unsigned.hap" -ForegroundColor White
    Write-Host ""
    
} else {
    Write-Host "✗ 命令行构建失败" -ForegroundColor Red
    Write-Host ""
    Write-Host "=====================================" -ForegroundColor Yellow
    Write-Host "  请使用 DevEco Studio 构建" -ForegroundColor Yellow
    Write-Host "=====================================" -ForegroundColor Yellow
    Write-Host ""
    Write-Host "步骤：" -ForegroundColor White
    Write-Host "1. 打开 DevEco Studio"
    Write-Host "2. Build → Clean Project"
    Write-Host "3. Build → Rebuild Project"
    Write-Host "4. Build → Build Hap(s)"
    Write-Host ""
    Write-Host "或者直接点击 Run 按钮（Shift + F10）" -ForegroundColor Green
    Write-Host ""
}
```

### 使用脚本

```powershell
# 1. 保存脚本为 rebuild.ps1

# 2. 在项目根目录运行
.\rebuild.ps1

# 3. 如果提示执行策略错误，运行：
Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass
.\rebuild.ps1
```

---

## 🎯 推荐流程

### 对于日常开发（最简单）

```
1. 修改代码/资源
2. 在 DevEco Studio 点击 Run（Shift + F10）
3. 应用自动安装到设备
4. 完成！
```

**优点**：
- ✅ 全自动，无需手动操作
- ✅ 实时看到效果
- ✅ 调试方便

---

### 对于生成独立安装包

```
1. Build → Clean Project
2. Build → Rebuild Project  
3. Build → Build Hap(s)
4. 在 entry/build/default/outputs/default/ 找到 HAP 文件
5. 复制到需要的位置
```

**优点**：
- ✅ 生成独立安装包
- ✅ 可以分享给其他人
- ✅ 可以离线安装

---

## ❓ 常见问题

### Q1: DevEco Studio 构建失败？

**可能原因：**
- SDK 未完整下载
- 签名配置错误
- 依赖未安装

**解决方案：**
```
1. File → Invalidate Caches / Restart
2. 删除 oh_modules 和 build 目录
3. Build → Clean Project
4. Build → Rebuild Project
```

---

### Q2: 图标没有更新？

**解决方案：**
```powershell
# 1. 完全卸载旧版本
hdc uninstall com.example.first

# 2. 清理缓存（可选）
hdc shell rm -rf /data/app/el1/bundle/public/com.example.first

# 3. 重新安装
hdc install PickCode-unsigned.hap

# 4. 重启设备（如果还不行）
hdc shell reboot
```

---

### Q3: 命令行打包提示权限错误？

**解决方案：**
```powershell
# 以管理员身份运行 PowerShell
Start-Process powershell -Verb runAs

# 然后执行打包命令
```

---

## 📊 打包后的文件对比

| 项目 | 旧版本 | 新版本（big_logo） |
|------|--------|-------------------|
| 文件名 | entry-default-unsigned.hap | entry-default-unsigned.hap |
| 应用图标 | layered_image（分层） | big_logo（单一图标） |
| 启动图标 | startIcon | big_logo |
| 大小 | ~525 KB | ~525 KB（相近） |
| 图标配置 | AppScope/app.json5 | ✅ 已更新 |
| 模块配置 | entry/module.json5 | ✅ 已更新 |

---

## ✅ 打包完成检查清单

打包完成后，请检查：

- [ ] HAP 文件已生成（entry/build/default/outputs/default/）
- [ ] 文件大小合理（约 500-600 KB）
- [ ] 时间戳是最新的（刚刚生成）
- [ ] 安装到设备成功
- [ ] 桌面图标显示为 big_logo
- [ ] 启动画面显示 big_logo
- [ ] 应用功能正常
- [ ] 所有权限授权正常（相机、短信）

---

## 📞 需要帮助？

如果遇到问题：

1. **查看日志**
   ```
   DevEco Studio → Terminal → 查看构建输出
   ```

2. **检查配置**
   - `AppScope/app.json5` - 应用级配置
   - `entry/src/main/module.json5` - 模块配置
   - `build-profile.json5` - 构建配置

3. **相关文档**
   - `打包安装说明.md` - 详细安装指南
   - `docs/签名配置指南.md` - 签名配置
   - `docs/图标更换说明.md` - 图标更换说明

---

**建议操作**：使用 DevEco Studio 的 **Run 按钮（Shift + F10）** 最简单快捷！

---

**文档版本**: v1.0  
**创建时间**: 2025-10-24  
**状态**: ✅ 待执行


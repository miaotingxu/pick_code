# 🎉 签名配置完成

> **完成时间**: 2025-10-25  
> **包名**: `com.mtx.take.code`  
> **签名类型**: 正式证书

---

## ✅ 配置完成清单

### 1. 签名文件 ✅

```
signature/
├── pickcode.p12  ✅ 密钥文件 (1,106 字节)
├── pickcode.cer  ✅ 证书文件 (2,910 字节)
└── pickcode.p7b  ✅ Profile文件 (4,002 字节)
```

**所有文件已就绪！**

---

### 2. 签名配置 ✅

**build-profile.json5** 已配置：

```json5
{
  "app": {
    "signingConfigs": [
      {
        "name": "default",
        "type": "HarmonyOS",
        "material": {
          "storeFile": "signature/pickcode.p12",
          "storePassword": "miao1234",
          "keyAlias": "pickcode_key",
          "keyPassword": "miao1234",
          "signAlg": "SHA256withRSA",
          "certpath": "signature/pickcode.cer",
          "profile": "signature/pickcode.p7b"
        }
      },
      {
        "name": "release",
        "type": "HarmonyOS",
        "material": {
          // 与 default 相同
        }
      }
    ]
  }
}
```

**配置参数**：
- 密钥文件：`signature/pickcode.p12`
- 证书文件：`signature/pickcode.cer`
- Profile：`signature/pickcode.p7b`
- 密码：`miao1234`
- 密钥别名：`pickcode_key`

---

## 🚀 下一步操作

### 步骤 1: 清理旧构建

**在 DevEco Studio 中**：
```
Build → Clean Project
```

**或使用命令行**（如果配置了 hvigorw）：
```powershell
hvigorw clean
```

---

### 步骤 2: 重新构建项目

**在 DevEco Studio 中**：
```
Build → Rebuild Project
```

这将使用新的签名配置重新编译项目。

---

### 步骤 3: 生成签名的 HAP 包

#### 方式 A: 生成调试版本（推荐先测试）

```
Build → Build Hap(s)/App(s) → Build Hap(s)
或按 Ctrl + F9
```

**输出位置**：
```
entry/build/default/outputs/default/entry-default-signed.hap
```

---

#### 方式 B: 生成发布版本

```
Build → Generate Hap(s)/App(s) → Generate Signed Hap(s)
选择 "release" 配置
点击 OK
```

**输出位置**：
```
entry/build/default/outputs/default/entry-release-signed.hap
```

---

### 步骤 4: 安装和测试

#### 卸载旧版本

```powershell
hdc uninstall com.mtx.take.code
```

#### 安装新签名的版本

```powershell
# 如果生成的是 debug 版本
hdc install entry\build\default\outputs\default\entry-default-signed.hap

# 如果生成的是 release 版本
hdc install entry\build\default\outputs\default\entry-release-signed.hap
```

#### 启动应用

```powershell
hdc shell aa start -a EntryAbility -b com.mtx.take.code
```

---

## 🧪 验证签名

### 检查应用信息

```powershell
# 查看已安装的应用
hdc shell bm dump -n com.mtx.take.code

# 查看应用详细信息
hdc shell bm dump -a | findstr "com.mtx.take.code"
```

### 验证证书有效期

如果安装成功并能正常运行，说明签名配置正确！

---

## 📋 签名配置参数

| 参数 | 值 | 说明 |
|------|-----|------|
| **Store File** | `signature/pickcode.p12` | 密钥库文件 |
| **Store Password** | `miao1234` | 密钥库密码 |
| **Key Alias** | `pickcode_key` | 密钥别名 |
| **Key Password** | `miao1234` | 密钥密码 |
| **Cert Path** | `signature/pickcode.cer` | 证书文件 |
| **Profile** | `signature/pickcode.p7b` | Profile配置文件 |
| **Sign Algorithm** | `SHA256withRSA` | 签名算法 |

---

## ⚠️ 重要提示

### 1. 文件安全

**签名文件已在 .gitignore 中排除**：
```gitignore
signature/*.p12  ✅ 不会提交到 Git
signature/*.cer  ✅ 不会提交到 Git
signature/*.p7b  ✅ 不会提交到 Git
*.p12           ✅ 不会提交到 Git
```

**请勿泄露**：
- ❌ `pickcode.p12` - 私钥文件
- ❌ `miao1234` - 密码
- ❌ 签名配置信息

---

### 2. 密码管理

**当前密码**: `miao1234`

**注意**：
- 密码已写入 `build-profile.json5`
- 如果项目是开源的，建议使用环境变量
- 或使用 DevEco Studio 的密码保护功能

---

### 3. 证书有效期

**定期检查**：
- 证书文件（.cer）的有效期
- Profile 文件（.p7b）的有效期（通常1年）
- 过期前需要重新申请

---

## 🎯 快速构建命令

### 使用 DevEco Studio（推荐）

```
1. 打开项目
2. Build → Clean Project
3. Build → Rebuild Project
4. Run → Run 'entry' (Shift + F10)
```

**DevEco Studio 会自动**：
- ✅ 使用配置的签名
- ✅ 生成签名的 HAP
- ✅ 安装到设备
- ✅ 启动应用

---

### 使用命令行

```powershell
# 1. 清理
hvigorw clean

# 2. 构建（Debug）
hvigorw assembleHap --mode module -p module=entry -p product=default

# 3. 构建（Release）
hvigorw assembleHap --mode module -p module=entry -p product=default --release

# 4. 安装
hdc install entry\build\default\outputs\default\entry-default-signed.hap

# 5. 启动
hdc shell aa start -a EntryAbility -b com.mtx.take.code
```

---

## 🔍 故障排查

### 问题 1: "签名失败 - 密码错误"

**解决方案**：
```
1. 确认密码：miao1234
2. 检查 build-profile.json5 中的密码
3. 确保 .p12 文件的密码正确
```

---

### 问题 2: "Profile 文件无效"

**可能原因**：
- Profile 文件过期
- Profile 与证书不匹配
- 包名不一致

**解决方案**：
```
1. 检查 Profile 文件有效期
2. 确认包名：com.mtx.take.code
3. 重新从 AppGallery Connect 下载 Profile
```

---

### 问题 3: "证书与应用包名不匹配"

**解决方案**：
```
1. 检查 AppGallery Connect 中的应用包名
2. 检查 AppScope/app.json5 中的 bundleName
3. 确保完全一致：com.mtx.take.code
```

---

### 问题 4: "找不到签名文件"

**解决方案**：
```powershell
# 检查文件是否存在
Test-Path signature\pickcode.p12
Test-Path signature\pickcode.cer
Test-Path signature\pickcode.p7b

# 都应该返回 True
```

---

## 📊 构建输出对比

| 构建类型 | 输出文件名 | 签名状态 | 用途 |
|---------|-----------|---------|------|
| **Debug** | `entry-default-signed.hap` | ✅ 已签名 | 开发测试 |
| **Release** | `entry-release-signed.hap` | ✅ 已签名 | 正式发布 |

---

## ✅ 配置验证清单

完成以下检查，确保配置正确：

- [x] 签名文件已复制到 signature 目录
- [x] pickcode.p12 存在
- [x] pickcode.cer 存在
- [x] pickcode.p7b 存在
- [x] build-profile.json5 已配置签名信息
- [x] 密码正确：miao1234
- [ ] 已清理并重新构建项目
- [ ] 能成功生成签名的 HAP 包
- [ ] HAP 包能成功安装到设备
- [ ] 应用能正常运行

---

## 🎉 成功标志

如果以下操作都成功，说明签名配置完全正确：

1. ✅ 构建项目无错误
2. ✅ 生成的 HAP 文件包含 "signed" 标记
3. ✅ HAP 能安装到设备
4. ✅ 应用能正常启动和运行
5. ✅ 所有功能正常（相机、短信等权限）

---

## 📞 后续操作

### 发布到应用市场

签名配置完成后，你可以：

1. **测试应用**
   - 完整功能测试
   - 多设备测试
   - 性能测试

2. **准备发布材料**
   - 应用截图
   - 应用描述
   - 隐私政策
   - 版本说明

3. **提交审核**
   - 登录 AppGallery Connect
   - 上传签名的 HAP 包
   - 填写应用信息
   - 提交审核

---

## 📝 相关文档

- 📄 `正式证书配置步骤.md` - 详细配置说明
- 📄 `签名配置操作指南.md` - 签名配置指南
- 📄 `打包安装说明.md` - 打包和安装流程
- 📄 `修改包名指南.md` - 包名修改说明

---

## 🎯 当前配置总结

```
应用信息：
├── 包名: com.mtx.take.code
├── 厂商: MTX
└── 版本: 1.0.0 (1000000)

签名配置：
├── 密钥文件: signature/pickcode.p12
├── 证书文件: signature/pickcode.cer
├── Profile: signature/pickcode.p7b
├── 密码: miao1234
└── 别名: pickcode_key

构建配置：
├── Debug 签名: default
├── Release 签名: release
└── 签名算法: SHA256withRSA
```

---

**🎉 签名配置完成！现在可以在 DevEco Studio 中重新构建项目了！**

**推荐操作**：
```
1. Build → Clean Project
2. Build → Rebuild Project
3. Run → Run 'entry' (Shift + F10)
```

---

**文档版本**: v1.0  
**创建时间**: 2025-10-25  
**状态**: ✅ 配置完成


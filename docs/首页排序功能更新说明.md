# 首页排序功能更新说明

## 📋 更新内容

### 修改前
首页顶部筛选栏显示多个快递公司标签，包括：
- 按时间
- 顺丰、中通、申通、韵达、极兔、邮政、圆通、京东、百世
- 其他

用户可以点击不同的快递公司标签来筛选显示特定快递公司的包裹。

### 修改后
首页顶部改为两个简洁的排序模式TAB：

#### 1️⃣ 按时间
- 显示所有快递包裹
- 按时间降序排列（最新的在前面）
- 相同日期的包裹按时间顺序显示

#### 2️⃣ 按快递公司
- 显示所有快递包裹
- **快递公司按待取件数量排序**（包裹数量多的公司排在上面）
- **同一快递公司内的包裹按时间排序**（最新的在前面）

## 🎯 核心逻辑

### 排序实现

```typescript
getSortedParcels(): ParcelModel[] {
  if (this.selectedSortMode === '按时间') {
    // 按时间排序（最新的在前面）
    return [...this.parcelList].sort((a, b) => b.createTime - a.createTime);
  } else {
    // 按快递公司排序
    return this.sortParcelsByCompanyCount(this.parcelList);
  }
}
```

### 按快递公司排序的详细步骤

1. **统计每个快递公司的包裹数量**
   ```typescript
   const companyCount = new Map<string, number>();
   parcels.forEach(parcel => {
     const company = parcel.courierCompany;
     companyCount.set(company, (companyCount.get(company) || 0) + 1);
   });
   ```

2. **按快递公司分组**
   ```typescript
   const companyGroups = new Map<string, ParcelModel[]>();
   parcels.forEach(parcel => {
     const company = parcel.courierCompany;
     if (!companyGroups.has(company)) {
       companyGroups.set(company, []);
     }
     companyGroups.get(company)?.push(parcel);
   });
   ```

3. **对每个快递公司的包裹按时间排序**
   ```typescript
   companyGroups.forEach((parcels, company) => {
     parcels.sort((a, b) => b.createTime - a.createTime);
   });
   ```

4. **按包裹数量排序快递公司**
   ```typescript
   const sortedCompanies = Array.from(companyGroups.keys()).sort((a, b) => {
     const countA = companyCount.get(a) || 0;
     const countB = companyCount.get(b) || 0;
     
     // 数量多的排前面
     if (countA !== countB) {
       return countB - countA;
     }
     
     // 数量相同，按首个包裹的创建时间排序
     const parcelsA = companyGroups.get(a) || [];
     const parcelsB = companyGroups.get(b) || [];
     if (parcelsA.length > 0 && parcelsB.length > 0) {
       return parcelsB[0].createTime - parcelsA[0].createTime;
     }
     
     return 0;
   });
   ```

5. **组合排序后的结果**
   ```typescript
   const sortedParcels: ParcelModel[] = [];
   sortedCompanies.forEach(company => {
     const companyParcels = companyGroups.get(company) || [];
     sortedParcels.push(...companyParcels);
   });
   ```

## 💡 使用场景

### 场景 1：查看最新的快递
选择 **"按时间"** 模式：
- 所有快递按时间顺序显示
- 快速找到刚到的包裹

### 场景 2：批量取同一快递公司的件
选择 **"按快递公司"** 模式：
- 同一快递公司的包裹集中显示
- 包裹多的公司排在上面，方便优先处理
- 适合一次性取完某个快递公司的所有包裹

## 🔧 技术细节

### 修改的文件
- `entry/src/main/ets/pages/Index.ets`

### 主要变更

1. **状态变量改名**
   - `selectedFilter` → `selectedSortMode`
   - 删除 `sortedFilterTags` （不再需要）

2. **删除的方法**
   - `updateFilterTagsOrder()` - 动态排序筛选标签
   - `getFilteredParcels()` - 按公司筛选

3. **新增的方法**
   - `getSortedParcels()` - 获取排序后的包裹列表

4. **修改的方法**
   - `getGroupedParcels()` - 使用新的排序逻辑
   - `FilterBar()` - 简化为两个TAB
   - `EmptyState()` - 简化空状态提示

5. **保留的方法**
   - `sortParcelsByCompanyCount()` - 按快递公司数量排序（核心逻辑）

## 📊 排序示例

### 按时间排序
```
12-23
  - 极兔速递 2-5-2418  17:45
  - 中通快递 6-2-2175  17:37
  - 圆通速递 6-2-2173  17:37
  - 京东快递 2-5-2498  17:37
```

### 按快递公司排序（假设中通有3件，圆通有2件，其他各1件）
```
12-23
  - 中通快递 6-2-2175  17:45  ← 数量最多(3)
  - 中通快递 6-2-2176  17:30
  - 中通快递 6-2-2177  17:20
  - 圆通速递 6-2-2173  17:40  ← 数量第二(2)
  - 圆通速递 6-2-2174  17:35
  - 极兔速递 2-5-2418  17:37  ← 数量相同(1)，按时间排序
  - 京东快递 2-5-2498  17:25
```

## 🎨 UI 效果

### 筛选栏布局
```
┌─────────────────────────────────────┐
│  [按时间]  [按快递公司]      ☐      │
└─────────────────────────────────────┘
```

- 左侧：两个TAB按钮
- 右侧：勾选框（保留原有功能）
- 选中的TAB有蓝色背景和白色文字
- 未选中的TAB为透明背景，带边框

## ✅ 测试要点

1. **切换排序模式**
   - 点击"按时间"，确认按时间排序
   - 点击"按快递公司"，确认按公司数量排序

2. **验证排序逻辑**
   - 按时间：最新的在前面
   - 按快递公司：数量多的公司在前面，同公司内按时间排序

3. **数据更新**
   - 添加新包裹后，排序自动更新
   - 标记已取后，剩余包裹排序正确

4. **空状态**
   - 无包裹时显示提示信息
   - 提示正确引导用户添加包裹

## 📝 总结

这次更新大大简化了首页的筛选逻辑，从多个快递公司标签改为两个清晰的排序模式：
- ✅ 界面更简洁
- ✅ 操作更直观
- ✅ 智能排序（按数量优先）
- ✅ 保留了原有的分组功能（按日期分组）

用户现在可以根据实际需求快速切换排序方式，提升了使用体验。


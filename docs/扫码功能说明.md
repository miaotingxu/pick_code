# 扫码功能说明

## 功能概述

通过扫描快递单上的条形码或二维码，自动识别物流单号和快递公司，并保存到本地数据库。

## 使用方法

1. **点击扫码按钮**
   - 在首页右上角，点击 "⊞" 扫码图标
   - 首次使用时会请求相机权限，请点击"允许"

2. **扫描快递单**
   - 将相机对准快递单上的条形码或二维码
   - 确保光线充足，条码清晰可见
   - 扫码框会自动识别并扫描

3. **查看结果**
   - 扫码成功后，系统会自动识别：
     - 物流单号（取件码）
     - 快递公司
     - 驿站名称（如果有）
     - 地址信息（如果有）
   - 识别成功会显示提示信息
   - 自动保存到"待取包裹"列表

4. **从相册选择**
   - 如果现场扫码不方便，可以先拍照
   - 点击扫码后，选择"从相册选择"
   - 选择包含条码的照片即可识别

## 支持的快递公司

### 主流快递（智能识别）
- ✅ 顺丰速运
- ✅ 中通快递
- ✅ 申通快递
- ✅ 韵达快递
- ✅ 极兔速递
- ✅ 圆通速递
- ✅ 京东快递
- ✅ 邮政快递（EMS）
- ✅ 百世快递
- ✅ 德邦快递
- ✅ 安能物流

### 驿站类型
- 菜鸟驿站
- 兔喜生活
- 妈妈驿站
- 其他第三方驿站

## 识别规则

### 1. 取件码格式
优先识别驿站取件码格式：
- `6-2-2175`（中通）
- `2-5-2418`（极兔）
- `6-3-1234`（圆通）

### 2. 完整物流单号
如果没有取件码，识别完整物流单号：
- 顺丰：`SF1234567890`（12位数字）
- 京东：`JD8888888888`（JD + 10-15位数字）
- 邮政：`EA123456789CN`（国际格式）
- 其他：10-20位数字或字母数字组合

### 3. 快递公司识别
- 优先通过二维码/条形码内容中的关键词识别
- 其次通过单号格式特征识别
- 如果都无法识别，标记为"未知快递"

### 4. 驿站信息提取
自动提取以下信息（如果存在）：
- 驿站名称：如"菜鸟驿站"、"兔喜生活"等
- 详细地址：包含省市区街道的完整地址
- 如果信息不完整，会显示默认值，可以在列表中长按编辑

## 权限说明

### 相机权限
- **用途**：扫描快递单上的条形码和二维码
- **使用时机**：仅在点击扫码按钮时使用
- **权限类型**：`ohos.permission.CAMERA`
- **安全性**：仅在应用内使用，不会上传或存储照片

## 技术实现

### 核心模块
- **扫码引擎**：`@kit.ScanKit`
- **支持格式**：所有标准条形码和二维码格式
  - QR Code（二维码）
  - Code 128（条形码）
  - Code 39、Code 93
  - EAN-13、EAN-8
  - PDF417
  - Data Matrix
  - 等所有标准格式

### 识别流程
```
扫码 → 内容解析 → 快递公司匹配 → 单号提取 → 驿站信息提取 → 保存数据库
```

### 容错处理
1. **扫码失败**：提示重试，可选择从相册选择
2. **识别失败**：提示手动添加
3. **部分信息缺失**：使用默认值，支持后续编辑
4. **重复扫描**：每次扫描都会创建新记录（不自动去重）

## 常见问题

### Q1: 扫码按钮点击后没有反应？
**A**: 检查是否授予了相机权限：
- 进入系统设置 → 应用管理 → 取码易 → 权限管理
- 确保"相机"权限已开启

### Q2: 扫描后识别不准确？
**A**: 可能的原因：
1. 条码不清晰或损坏 → 尝试从相册选择更清晰的照片
2. 光线不足 → 在光线充足的环境下扫描
3. 快递公司特殊 → 使用手动添加功能

### Q3: 识别为"未知快递"怎么办？
**A**: 
1. 扫描成功但识别不出公司名，记录会保存为"未知快递"
2. 可以在列表中长按编辑，手动修改快递公司
3. 或删除后使用"添加"功能手动录入

### Q4: 能识别国际快递吗？
**A**: 
- 支持国际快递的条码扫描
- 但快递公司识别库主要针对国内快递
- 国际快递可能显示为"未知快递"，需手动编辑

### Q5: 扫码后信息不完整？
**A**: 
- 部分快递单的二维码只包含单号，不包含驿站信息
- 系统会自动填充默认值（如"驿站"、"请手动补充地址"）
- 保存后可以在列表中查看并编辑

## 性能优化

- ✅ 单次扫描模式，避免重复识别
- ✅ 智能正则匹配，快速提取关键信息
- ✅ 异步处理，不阻塞 UI
- ✅ 错误容错，提供友好的失败提示

## 后续优化计划

- [ ] 支持批量扫描（连续扫描多个快递单）
- [ ] OCR 文字识别（识别打印的单号）
- [ ] 历史扫描记录
- [ ] 扫描统计分析
- [ ] 自定义快递公司库

---

**版本**: v1.0  
**更新时间**: 2025-10-24  
**作者**: PickCode 开发团队


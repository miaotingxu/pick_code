# 短信导入功能说明

## 🎉 功能概述

现在"取件助手"支持从短信直接导入取件码！支持两种导入方式：

### 方式 1：短信分享导入 ⭐（推荐）
用户收到快递短信后，直接分享到应用。

### 方式 2：剪贴板导入
复制短信内容后，在应用内一键导入。

---

## 📱 使用方法

### 方式 1：短信分享导入

#### 操作步骤
1. **收到快递短信**
   ```
   【菜鸟驿站】您的快递已到达菜鸟驿站
   取件码：2-5-2418
   地址：杭州万泰凤华新建店
   ```

2. **长按短信内容**
   - 选择"分享"或"转发"

3. **选择"取件助手"应用**
   - 在分享菜单中找到"取件助手"图标
   - 点击分享

4. **自动识别并确认**
   - 应用自动解析短信内容
   - 显示识别结果（取件码、快递公司、驿站等）
   - 可以修改错误的信息
   - 点击"保存"完成导入

---

### 方式 2：剪贴板导入

#### 操作步骤
1. **复制短信内容**
   - 长按短信 → 选择"复制"

2. **打开取件助手**
   - 进入应用主页（待取页面）

3. **点击导入按钮 📋**
   - 在右上角工具栏，点击剪贴板图标 📋

4. **自动识别并确认**
   - 应用自动解析剪贴板内容
   - 显示识别结果
   - 确认后保存

---

## 🔍 支持的短信格式

### 标准格式
```
【快递公司】您的快递已到达xxx
取件码：X-X-XXXX
地址：xxx
```

### 识别能力

| 信息 | 识别规则 | 示例 |
|------|---------|------|
| **取件码** | 数字-数字-数字 | `2-5-2418` |
| **快递公司** | 关键词匹配 | 中通、圆通、顺丰、京东... |
| **驿站名称** | 驿站/超市/店 | 菜鸟驿站、兔喜生活、妈妈驿站 |
| **地址** | "地址："后的内容 | 杭州万泰凤华新建店 |

### 支持的快递公司（11家）
- 顺丰速运
- 中通快递
- 申通快递
- 韵达快递
- 极兔速递
- 邮政快递
- 圆通速递
- 京东快递
- 百世快递
- 德邦快递
- 安能物流

---

## 🎯 使用场景

### 场景 1：收到新快递通知
```
收到短信 → 分享到取件助手 → 自动保存 ✅
```
**优势**：最快捷，无需手动输入

### 场景 2：批量导入历史快递
```
打开短信应用 → 复制多条快递短信 → 逐条导入 ✅
```
**优势**：快速整理历史取件码

### 场景 3：他人转发的取件信息
```
接收转发消息 → 复制内容 → 剪贴板导入 ✅
```
**优势**：适用于微信、QQ等其他渠道

---

## ⚙️ 技术实现

### 1. 分享接收配置
```json5
// module.json5
"skills": [
  {
    "entities": ["entity.system.default"],
    "actions": ["ohos.want.action.sendData"],
    "uris": [{
      "type": "text/plain"  // 接收文本类型
    }]
  }
]
```

### 2. 短信解析引擎
```typescript
// SmsService.ets
parseSmsContent(content: string): ParcelModel | null {
  // 正则匹配取件码
  const pickupCodePattern = /取件码[：:]\s*(\d+-\d+-\d+)/i;
  
  // 识别快递公司
  for (const company of Constants.COURIER_COMPANIES) {
    const regex = new RegExp(company.keyword, 'i');
    if (regex.test(content)) {
      courierCompany = company.name;
      break;
    }
  }
  
  // 提取驿站和地址
  // ...
}
```

### 3. 数据传递流程
```
短信应用 
  ↓ (分享)
EntryAbility.handleShareIntent() 
  ↓ (AppStorage)
SmsImport 页面
  ↓ (解析)
SmsService.parseSmsContent()
  ↓ (保存)
ParcelDatabase.insertParcel()
  ↓
首页显示
```

---

## 📊 功能对比

| 导入方式 | 优点 | 缺点 | 推荐度 |
|---------|------|------|--------|
| **短信分享** | 最快捷，系统级集成 | 需要系统支持分享 | ⭐⭐⭐⭐⭐ |
| **剪贴板导入** | 适用性广，简单 | 需要复制操作 | ⭐⭐⭐⭐ |
| **手动输入** | 完全可控 | 最慢 | ⭐⭐⭐ |
| **扫码** | 准确 | 需要二维码 | ⭐⭐⭐⭐ |

---

## 🐛 常见问题

### Q1: 分享菜单找不到"取件助手"？
**A**: 
- 确保应用已安装并运行过一次
- 检查系统版本是否支持应用分享
- 重启设备后重试

### Q2: 识别失败怎么办？
**A**: 
- 检查短信格式是否包含"取件码"关键字
- 使用剪贴板导入，手动修改识别结果
- 或者使用手动添加功能

### Q3: 可以导入其他格式的取件码吗？
**A**: 
当前支持：
- 数字格式：`2-5-2418`
- 长单号：`SF1234567890`、`JD8888888888`

如需支持其他格式，可以修改正则表达式。

### Q4: 导入后能修改吗？
**A**: 
可以！导入页面会显示识别结果，保存前可以修改所有字段。

---

## 🚀 未来优化方向

### 计划中的功能
- [ ] 自动监听短信（需要系统权限）
- [ ] 批量导入（一次处理多条短信）
- [ ] 智能去重（检测重复取件码）
- [ ] 支持更多快递公司
- [ ] OCR 识别（拍照导入）

---

## 📝 测试建议

### 测试用例

#### 测试 1: 标准短信
```
【中通快递】您的快递已到达菜鸟驿站
取件码：6-2-2175
地址：杭州万泰凤华新建店
```
**预期结果**：✅ 成功识别所有信息

#### 测试 2: 长单号
```
【顺丰速运】您的快递已到达
取件码：SF1234567890
地址：杭州文三路营业点
```
**预期结果**：✅ 成功识别长单号

#### 测试 3: 不包含取件码
```
【淘宝】您的订单已发货
快递单号：YT1234567890
```
**预期结果**：❌ 提示"未识别到取件码"

---

## 🎨 UI 截图说明

### 导入成功页面
```
┌────────────────────────────┐
│  ← 短信导入                 │
├────────────────────────────┤
│                            │
│         ✓                  │
│    识别成功！               │
│  请确认以下信息             │
│                            │
│  取件码                     │
│  [2-5-2418        ]        │
│                            │
│  快递公司                   │
│  [中通快递         ]        │
│                            │
│  驿站名称                   │
│  [菜鸟驿站         ]        │
│                            │
│  地址                      │
│  [杭州万泰凤华新建店]        │
│                            │
│  [取消]        [保存]       │
└────────────────────────────┘
```

### 识别失败页面
```
┌────────────────────────────┐
│  ← 短信导入                 │
├────────────────────────────┤
│                            │
│         ✗                  │
│   未识别到取件码            │
│                            │
│  短信内容示例：              │
│  ┌──────────────────────┐  │
│  │【菜鸟驿站】您的快递已到达│  │
│  │取件码：2-5-2418       │  │
│  └──────────────────────┘  │
│                            │
│      [返回]                │
└────────────────────────────┘
```

---

## 💡 最佳实践

### 推荐工作流
1. **收到快递短信** → 立即分享到取件助手
2. **批量整理** → 使用剪贴板导入历史短信
3. **定期清理** → 已取的快递点击"已取"标记

### 提高识别率的技巧
- 完整复制短信内容（不要截取部分）
- 确保包含"取件码"关键字
- 如果识别失败，检查短信格式

---

## 📞 反馈与支持

如果遇到问题或有改进建议，欢迎反馈！


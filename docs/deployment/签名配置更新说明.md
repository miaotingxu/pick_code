# 签名配置更新说明

## ✅ 已完成配置

### 📂 签名文件位置

```
signature/
├── takecode.p12           ✅ 密钥库文件
├── takecode_release.cer   ✅ 证书文件
├── takecodeRelease.p7b    ✅ Profile文件（发布版）
├── takecode.csr           ℹ️ 证书签名请求（已使用，可保留）
└── README.md              📖 说明文档
```

---

## 🔧 更新的配置

### build-profile.json5

```json5
{
  "app": {
    "signingConfigs": [
      {
        "name": "default",
        "type": "HarmonyOS",
        "material": {
          "storeFile": "signature/takecode.p12",           // ✅ 相对路径
          "storePassword": "miao1234",                     // ✅ 你的密码
          "keyAlias": "takecode",                          // ⚠️ 可能需要确认
          "keyPassword": "miao1234",                       // ✅ 你的密码
          "signAlg": "SHA256withECDSA",                    // ✅ 签名算法
          "certpath": "signature/takecode_release.cer",    // ✅ 证书路径
          "profile": "signature/takecodeRelease.p7b"       // ✅ Profile路径
        }
      },
      {
        "name": "release",
        "type": "HarmonyOS",
        "material": {
          // 与 default 配置相同
        }
      }
    ]
  }
}
```

**关键变化**：
- ✅ 从绝对路径改为相对路径
- ✅ 从 `.ohos/config/` 改为 `signature/`
- ✅ 从 `debugKey` 改为 `takecode`
- ✅ 密码改为你提供的 `miao1234`

---

## ⚠️ 需要验证的配置

### keyAlias 验证

**当前配置**：`"keyAlias": "takecode"`

这是根据文件名推测的，可能不正确。请按以下方法验证：

#### 方法1：在 DevEco Studio 中验证

```
1. Build → Clean Project
2. Build → Build Hap(s)/App(s) → Build Hap(s)
3. 查看构建日志
```

**如果构建失败**，错误信息会显示：
```
KeyAlias {takecode} is not exist in {signature/takecode.p12}
```

#### 方法2：查看密钥库（需要 Java）

如果你的系统安装了 Java JDK，可以运行：

```bash
# Windows PowerShell
cd F:\HarmonyOS\PickCode
$env:JAVA_HOME\bin\keytool -list -v -keystore signature\takecode.p12 -storepass miao1234

# 查看输出中的 "别名名称:" 或 "Alias name:"
```

#### 方法3：常见的别名

如果 `takecode` 不对，尝试这些常见别名：
- `key0`
- `release`
- `takecode_key`
- `default`

---

## 🚀 构建和测试

### 步骤1：清理旧构建

```
DevEco Studio:
Build → Clean Project
```

### 步骤2：重新构建

```
Build → Build Hap(s)/App(s) → Build App(s)
```

### 步骤3：检查输出

**成功标志**：
```
entry/build/default/outputs/default/
└── entry-default-signed.hap  ✅ 签名成功
```

**失败标志**：
```
ERROR: KeyAlias {xxx} is not exist
→ 需要修改 keyAlias
```

---

## 🔧 如果构建失败

### 错误1：KeyAlias 不存在

**错误信息**：
```
KeyAlias {takecode} is not exist in {signature/takecode.p12}
```

**解决方法**：
1. 打开 `build-profile.json5`
2. 修改 `keyAlias` 的值
3. 尝试其他常见别名：`key0`, `release`, `default`
4. 重新构建

**修改示例**：
```json5
"keyAlias": "key0",  // 从 "takecode" 改为 "key0"
```

### 错误2：密码错误

**错误信息**：
```
Keystore was tampered with, or password was incorrect
```

**解决方法**：
- 确认密码是否正确
- 密码可能不是 `miao1234`
- 联系生成密钥库的人确认密码

### 错误3：Profile 文件非法

**错误信息**：
```
Profile file is invalid
```

**解决方法**：
1. 检查 Profile 文件是否是**发布类型**
2. 检查 Profile 中的 Bundle ID 是否为 `com.mtx.take.code`
3. 检查 Profile 是否过期
4. 重新从华为开发者后台下载 Profile

---

## 📊 配置对比

| 配置项 | 更新前 | 更新后 |
|--------|--------|--------|
| **路径类型** | 绝对路径 | 相对路径 ✅ |
| **文件位置** | `.ohos/config/` | `signature/` ✅ |
| **keyAlias** | `debugKey` | `takecode` ⚠️ |
| **签名类型** | 调试签名 | 正式签名 ✅ |
| **密码** | 自动生成 | `miao1234` ✅ |

---

## 📝 后续步骤

### 1. 验证构建
```bash
Build → Build App(s)
```

### 2. 检查签名
```bash
# 查看生成的 HAP 包
entry/build/default/outputs/default/entry-default-signed.hap
```

### 3. 上传测试
```
AppGallery Connect → 我的应用 → PickCode
→ 版本信息 → 上传 HAP 包
→ 测试是否还有错误码 993
```

---

## ✅ 预期结果

如果 keyAlias 正确，你应该看到：

```
✓ 构建成功
✓ 生成 entry-default-signed.hap
✓ 上传 AppGallery 成功
✓ 错误码 993 消失
```

---

## 🆘 需要帮助？

### 如果 keyAlias 不确定

请告诉我构建的错误信息，我会帮你调整。

### 如果密码不对

请提供正确的密码，我会更新配置。

### 如果还有其他错误

请提供完整的错误信息，我会帮你分析。

---

## 📋 配置文件备份

**原配置已保留在 Git 历史中**，如需恢复：
```bash
git checkout HEAD~1 -- build-profile.json5
```

---

**更新时间**：2025-10-25  
**状态**：✅ 配置已更新，待验证 keyAlias


# 版本兼容性配置说明

## ✅ 最终配置（兼容旧版本）

### 配置方案

```json5
{
  "products": [
    {
      "name": "default",
      "targetSdkVersion": "5.0.0(12)",        // 目标版本：HarmonyOS 5.0
      "compatibleSdkVersion": "4.1.0(11)",    // 最低支持：HarmonyOS 4.1 ✅
      "buildOption": {
        "strictMode": {
          "useNormalizedOHMUrl": false        // 关闭以兼容旧版本 ✅
        }
      }
    }
  ]
}
```

## 📊 版本兼容性对比

### 方案对比

| 配置 | 方案 A（当前）| 方案 B |
|------|-------------|---------|
| **targetSdkVersion** | 5.0.0(12) | 5.0.0(12) |
| **compatibleSdkVersion** | 4.1.0(11) ✅ | 5.0.0(12) |
| **useNormalizedOHMUrl** | false ✅ | true |
| **支持设备** | HarmonyOS 4.1+ ✅ | HarmonyOS 5.0+ |
| **设备覆盖率** | **更广** ✅ | 较窄 |

### 方案 A（当前配置）- 推荐

**✅ 优势**：
- 兼容 HarmonyOS 4.1 及以上所有设备
- 设备覆盖率最高（包括 4.1、4.2、5.0、5.x）
- 适合大部分用户场景

**⚠️ 劣势**：
- 不使用 `useNormalizedOHMUrl` 新特性（影响极小）

### 方案 B（高版本配置）

**✅ 优势**：
- 支持 `useNormalizedOHMUrl` 新特性

**❌ 劣势**：
- 只支持 HarmonyOS 5.0 及以上
- 排除所有 HarmonyOS 4.x 设备
- 设备覆盖率低

## 🎯 支持的设备范围

### 当前配置（4.1.0 - 11）

```
支持的系统版本：
├── HarmonyOS 4.1  ✅
├── HarmonyOS 4.2  ✅
├── HarmonyOS 5.0  ✅
├── HarmonyOS 5.x  ✅
└── 未来版本      ✅
```

**市场覆盖**：
- ✅ 包含大部分华为/荣耀设备
- ✅ 包含 Mate/P 系列老机型
- ✅ 包含 nova 系列设备

### 高版本配置（5.0.0 - 12）

```
支持的系统版本：
├── HarmonyOS 4.1  ❌ 不支持
├── HarmonyOS 4.2  ❌ 不支持
├── HarmonyOS 5.0  ✅
├── HarmonyOS 5.x  ✅
└── 未来版本      ✅
```

**市场覆盖**：
- ❌ 排除大量老设备
- ⚠️ 覆盖率显著降低

## 💡 `useNormalizedOHMUrl` 说明

### 这是什么？

`useNormalizedOHMUrl` 是一个编译优化选项，用于：
- 标准化 OHM (OpenHarmony Module) URL 路径
- 改善模块引用的一致性

### 影响大吗？

**❌ 影响极小**：
- 这是一个编译时优化选项
- 对应用功能**没有任何影响**
- 对用户体验**没有任何影响**
- 只是内部模块路径的处理方式不同

### 需要开启吗？

**🤔 根据需求选择**：

| 场景 | 建议 |
|------|------|
| **需要兼容旧设备** | ❌ 关闭（设为 false）✅ |
| **只针对新设备** | ✅ 开启（设为 true） |
| **不确定** | ❌ 关闭（设为 false）✅ |

**结论**：大部分情况下建议关闭，以获得最大设备兼容性。

## 🔍 版本号详解

### targetSdkVersion（目标 SDK）

**定义**：应用针对哪个版本的 API 开发

**设置为 5.0.0(12)**：
- ✅ 使用 HarmonyOS 5.0 的所有新 API
- ✅ 获得最新功能支持
- ✅ 向后兼容（可运行在更高版本）

### compatibleSdkVersion（兼容 SDK）

**定义**：应用支持的最低系统版本

**设置为 4.1.0(11)**：
- ✅ 支持 HarmonyOS 4.1 及以上所有版本
- ✅ 覆盖更多旧设备
- ✅ 市场安装量最大化

### 两者关系

```
compatibleSdkVersion ≤ 实际设备版本 ≤ targetSdkVersion（推荐）

示例：
应用配置：compatible=4.1, target=5.0
├── HarmonyOS 4.1 设备  ✅ 可安装运行
├── HarmonyOS 4.5 设备  ✅ 可安装运行
├── HarmonyOS 5.0 设备  ✅ 可安装运行（最佳体验）
└── HarmonyOS 5.5 设备  ✅ 可安装运行
```

## 📱 实际设备示例

### 可以安装你的应用的设备

**HarmonyOS 4.1+**：
- ✅ Mate 40 系列
- ✅ Mate 50 系列
- ✅ P50 系列
- ✅ nova 10 系列
- ✅ MatePad Pro 系列（旧款）

**HarmonyOS 5.0+**：
- ✅ Mate 60 系列
- ✅ Mate X5 折叠屏
- ✅ nova 12 系列
- ✅ 所有新设备

### 如果使用 compatibleSdkVersion=5.0.0

**无法安装的设备**：
- ❌ Mate 40 系列（大部分是 4.x）
- ❌ Mate 50 系列（部分是 4.x）
- ❌ P50 系列（大部分是 4.x）
- ❌ nova 10 系列（部分是 4.x）
- ❌ 大量老款平板

**损失**：可能损失 **30-50%** 的潜在用户！

## 🚀 构建和测试

### 在 DevEco Studio 中构建

1. **打开项目**
2. **菜单**：`Build` → `Build Hap(s)/App(s)` → `Build Hap(s)`
3. **等待完成**

### 验证配置

构建日志中会显示：
```
Target SDK Version: 5.0.0(12)
Compatible SDK Version: 4.1.0(11)  ✅ 确认这个值
```

### 测试兼容性

**理想测试设备**：
- 一台 HarmonyOS 4.x 设备（验证最低兼容性）
- 一台 HarmonyOS 5.x 设备（验证最佳体验）

## 📦 上传到 AppGallery

### 不会有问题

使用 `compatibleSdkVersion: 4.1.0(11)` 上传到 AppGallery：
- ✅ 完全支持
- ✅ 不会报错
- ✅ 设备匹配范围更广
- ✅ 测试设备充足

### 测试设备

AppGallery Connect 的测试设备池：
- ✅ HarmonyOS 4.1+ 设备充足
- ✅ HarmonyOS 5.0+ 设备充足
- ✅ 不会出现"没有匹配设备"错误

## 💡 推荐配置总结

### 当前配置（✅ 推荐）

```json5
{
  "targetSdkVersion": "5.0.0(12)",        // 使用 5.0 新特性
  "compatibleSdkVersion": "4.1.0(11)",    // 兼容 4.1 旧设备
  "useNormalizedOHMUrl": false            // 关闭以兼容旧版本
}
```

**适用场景**：
- ✅ 普通应用（推荐）
- ✅ 需要最大用户覆盖
- ✅ 不确定用户设备情况
- ✅ **你的 PickCode 应用（推荐）**

### 替代配置（不推荐）

```json5
{
  "targetSdkVersion": "5.0.0(12)",
  "compatibleSdkVersion": "5.0.0(12)",    // 只支持新设备
  "useNormalizedOHMUrl": true             // 使用新特性
}
```

**适用场景**：
- ⚠️ 明确只针对新设备
- ⚠️ 需要 `useNormalizedOHMUrl` 特性（极少数情况）
- ⚠️ 可以牺牲大量潜在用户

## ✅ 最终建议

### 你的 PickCode 应用

**推荐使用当前配置**：
- `targetSdkVersion: "5.0.0(12)"`
- `compatibleSdkVersion: "4.1.0(11)"` ✅
- `useNormalizedOHMUrl: false` ✅

**理由**：
1. ✅ 覆盖最多设备（HarmonyOS 4.1+）
2. ✅ 没有功能损失（`useNormalizedOHMUrl` 影响极小）
3. ✅ AppGallery 上传无问题
4. ✅ 测试设备充足
5. ✅ 最大化安装量和用户覆盖

---

**配置时间**：2025-10-25  
**适用项目**：PickCode  
**推荐配置**：API 12 (target) + API 11 (compatible)

